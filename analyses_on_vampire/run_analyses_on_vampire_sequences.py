import os
import pandas as pd
from scripts.seq_len_filtering import filter_by_cdr3_length
from scripts.kmer_freq_plotting import run_kmer_analysis

# import training and generated data
simulated_data = 'results/dataset1/simulations/train/simulation_0/dataset/simulated_dataset.tsv'
vampire_generated = 'vae-generated.csv'  # file generated by vampire

# change columns names of vampire_generated
vampire_generated = pd.read_csv(vampire_generated)
vampire_generated.columns = ['junction_aa', 'v_call', 'j_call']
vampire_generated.to_csv('analyses_on_vampire/vampire_generated.tsv', sep='\t', index=False)

# TO DO: run sequence length analysis

# filter sequences for AA freq distribution analysis
filter_by_cdr3_length(simulated_data, 'simulated_filtered_15.tsv', 15)
filter_by_cdr3_length('analyses_on_vampire/vampire_generated.tsv', 'vampire_filtered_15.tsv', 15)
shell_command = "python -m scripts.aa_freq_plotting simulated_filtered_15.tsv vampire_filtered_15.tsv 15 analyses_on_vampire/aa_output vampire_VAE"
os.system(shell_command)

# kmer analysis
run_kmer_analysis("analyses_on_vampire/vampire_generated.tsv", "vampire_VAE", simulated_data, "simulated data", "analyses_on_vampire/kmer_output", k=3, kmer_count_threshold=5)